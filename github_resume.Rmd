---
title: "Caspar J. van Lissa"
subtitle: "Veni-funded developmental data scientist and Open Science faculty ambassador. Using machine learning to predict teenagers' emotional problems"
date: "`r Sys.Date()`"
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "docs", output_file = "index.html") })    
output:
  html_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "asis", eval = TRUE)
print_cv <- function(table, ...){
  Args <- as.list(match.call()[-c(1, 2)])
  cat(apply(table, 1, function(x){
    do.call(paste0, Args)
}), sep = "  \n")
}
calculate_g <- function(x){
  x <- x[order(x$cites, decreasing = TRUE), ]
  which(diff(cumsum(x$cites) > ((1:nrow(x))^2)) == -1)
}

library(knitr)
library(kableExtra)
library(dplyr)
library(DT)
library(scholar)
library(dlstats)
library(renv)
id <- 'ub59lUMAAAAJ'

## Get his profile
scholar_profile <- get_profile(id)
scholar_pubs <- get_publications(id)
scholar_pubs[sapply(scholar_pubs, is.factor)] <- lapply(scholar_pubs[sapply(scholar_pubs, is.factor)], as.character)
```

## Experience

```{r results = "asis", echo = FALSE}
exp <- read.csv("Experience.csv", stringsAsFactors = FALSE)
#exp <- exp[order(exp$Order, decreasing = TRUE), ]
#exp$Begin <- gsub(" –.+$", "", exp$dates)
#exp$End <- gsub("^.+ – ", "", exp$dates)
exp <- exp[order(gsub("^\\w{3} ", "", exp$Begin), decreasing = TRUE), ]

row.names(exp) <- NULL
exp %>%  mutate(Employer=text_spec(Employer, "html", tooltip=Description)) %>% 
  mutate(Department=text_spec(Department, "html", tooltip=Description)) %>% 
  mutate(Position=text_spec(Position, "html", tooltip=Description)) %>% 
  mutate(Begin=text_spec(Begin, "html", tooltip=Description)) %>% 
  mutate(End=text_spec(End, "html", tooltip=Description)) %>% 
    select(Employer,Department, Position, Begin, End) %>% DT::datatable(escape = F, options = list(dom = 't'), rownames = FALSE)
```

## Education

```{r results = "asis", echo = FALSE}
edu <- read.csv("education.csv", stringsAsFactors = FALSE)
#edu <- edu[order(edu$Order, decreasing = TRUE), ]
#edu$Begin <- gsub(" –.+$", "", edu$dates)
#edu$End <- gsub("^.+ – ", "", edu$dates)
#edu <- edu[order(gsub("^\\w{3} ", "", edu$Begin), decreasing = TRUE), ]

row.names(edu) <- NULL
edu %>%  mutate(Institute=text_spec(Institute, "html", tooltip=Description)) %>% 
  mutate(Field=text_spec(Field, "html", tooltip=Description)) %>% 
  mutate(Degree=text_spec(Degree, "html", tooltip=Description)) %>% 
  mutate(Date=text_spec(Date, "html", tooltip=Description)) %>% 
    select(Institute,Field, Degree, Date) %>% DT::datatable(escape = F, options = list(dom = 't'), rownames = FALSE)
```

## Publications

According to [Google Scholar](https://scholar.google.com/citations?user=ub59lUMAAAAJ), my work has been cited `r scholar_profile$total_cites` times (G-index: `r calculate_g(scholar_pubs)`, H-index: `r scholar_profile$h_index`, i10-index: `r scholar_profile$i10_index`).

```{r results = "asis", echo = FALSE}
#pub <- read.csv("My publications.csv", stringsAsFactors = FALSE, encoding = "UTF-8")
pub <- scholar_pubs
#pub$Item.Type <- ifelse(pub$Item.Type == "journalArticle", "", " (Book chapter)")
#num_authors <- lengths(regmatches(pub$Author, gregexpr(";", pub$Author)))
# Format authors in APA style
authors <- sapply(strsplit(pub$author, ","), function(x){
  #browser()
  initials <- gsub("^(.+?)\\s.*$", "\\1", trimws(x))
  initials <- sapply(initials, function(i){
    paste0(substring(i, seq(1, nchar(i), 1), seq(1, nchar(i), 1)), ".", collapse = " ")
  })
  last <- gsub("^.+?\\s", "", trimws(x))
  paste0(last, ", ", initials, collapse = "; ")
})
authors <- gsub(";(?= [a-zA-Z ]+, ([A-Z]\\.){1,}$)", "; &", authors, perl = TRUE)
pub$author <- gsub("\\.{3}, \\.{2} \\.{2} \\.{2}", "et al\\.", authors)
# Abbreviate authors
num_authors <- lengths(regmatches(pub$author, gregexpr(";", pub$author)))
pub$author[num_authors > 4] <- gsub(";.+$", "; et al\\.", pub$author[num_authors > 4])
pub$author <- gsub("van Lissa", "Van Lissa", pub$author)
pub$author <- gsub(";", ",", pub$author)
pub$title[grepl(":", pub$title)] <- gsub(":.+$", "", pub$title[grepl(":", pub$title)])

pub$year[is.na(pub$year)] <- "in press"

pub$journal[!pub$journal == ""] <- paste0('<i>', pub$journal[!pub$journal == ""], '</i>')
pub$journal[grepl("(mplusautomation|bain|gorica)", tolower(pub$title))] <- "<tt>CRAN</tt>"
#pub$DOI[!pub$DOI == ""] <- paste0("https://doi.org/", pub$DOI[!pub$DOI == ""])
#pub$DOI[pub$DOI == ""] <- pub$Url[pub$DOI == ""]
#pub <- data.frame(pub)
#pub$Title <- paste0('<a href = "', pub$DOI, '">', pub$Title, '</a>')

pub <- pub[order(pub$cites, decreasing = TRUE), c("author", "year", "title", "journal", "cites")]
rownames(pub) <- NULL
names(pub) <- c("Authors", "Year", "Title", "Publication", "Cited")

pub %>% DT::datatable(escape=F)
```

## Software

```{r results = "asis", echo = FALSE}
pack <- data.frame(read.csv("R-packages.csv", stringsAsFactors = FALSE))
downloads <- dlstats::cran_stats(pack$title)
pack$downloads <- tapply(downloads$downloads, downloads$package, sum)
write.csv(pack, "R-packages.csv", row.names = FALSE)
pack <- pack[order(pack$downloads, decreasing = TRUE, na.last = TRUE), ]
pack$downloads[!is.na(pack$downloads)] <- paste0(pack$downloads[!is.na(pack$downloads)], " downloads. ")
pack$downloads[is.na(pack$downloads)] <- ""
pack$Title <- paste0('<a href = "', pack$url, '">', pack$title, '</a>')
pack$Outlet <- paste0('<tt>', pack$repo, '</tt>')
pack$Downloads <- pack$downloads
pack$Authors <- pack$authors
rownames(pack) <- NULL
pack[,c("Authors", "Title", "Downloads", "Outlet")] %>%
  DT::datatable(escape = FALSE, options = list(dom = 't'))
```

## Managerial activities

```{r results = "asis", echo = FALSE}
manage <- data.frame(read.csv("managerial.csv", stringsAsFactors = FALSE))
manage <- manage[, c("Activity", "Start", "End", "Category")]
manage %>%  DT::datatable(escape = F, options = list(dom = 't'), rownames = FALSE)
```

## International experience

```{r results = "asis", echo = FALSE}
int <- data.frame(read.csv("international.csv", stringsAsFactors = FALSE))
int %>%  mutate(Institute=text_spec(Institute, "html", tooltip=Details)) %>% 
  mutate(Country=text_spec(Country, "html", tooltip=Details)) %>% 
  mutate(Date=text_spec(Date, "html", tooltip=Details)) %>% 
  select(-Details) %>%
  DT::datatable(escape = F,options = list(dom = 't'), rownames = FALSE)
```

## Invited lectures

```{r results = "asis", echo = FALSE}
invited <- data.frame(read.csv("invited.csv", stringsAsFactors = FALSE))
rownames(invited) <- NULL
invited %>%  mutate(Institute=text_spec(Institute, "html", tooltip=Topic)) %>% 
  mutate(Year=text_spec(Year, "html", tooltip=Topic)) %>% 
  mutate(City=text_spec(City, "html", tooltip=Topic)) %>% 
  mutate(Country=text_spec(Country, "html", tooltip=Topic)) %>% 
  select(Institute, City, Country, Year) %>%
  DT::datatable(escape = F,options = list(dom = 't'), rownames = FALSE)
```

## Funding

```{r results = "asis", echo = FALSE}
grant <- data.frame(read.csv("funding_acquired.csv", stringsAsFactors = FALSE), check.names = F)
names(grant) <- gsub("\\.", " ", names(grant))
grant$Date <- as.Date(grant$Date, format = "%d-%m-%Y")
grant$Date <- format.Date(grant$Date, "%b %Y")
grant %>% DT::datatable(escape = FALSE,options = list(dom = 't'), rownames = FALSE)
```

## Collaborations

```{r results = "asis", echo = FALSE}
collab <- data.frame(read.csv("Collaborations.csv", stringsAsFactors = FALSE))
names(collab)[3] <- "Key collaborator"
collab %>%  mutate(Organization=text_spec(Organization, "html", tooltip=Purpose)) %>% 
  mutate("Key collaborator"=text_spec(collab[["Key collaborator"]], "html", tooltip=Purpose)) %>%
  select(Organization, "Key collaborator") %>% DT::datatable(escape = F, options = list(dom = 't'), rownames = FALSE)
```

## Reviewer & Editorial experience

```{r}
rev <- read.csv("review.csv", stringsAsFactors = FALSE, header = FALSE)
names(rev) <- c("N", "Name", "Category")
rev_tab <- tapply(rev$N, factor(rev$Category), sum)
```

I am Statistical Consulting Editor for [Child Development](https://srcd.onlinelibrary.wiley.com/journal/14678624), and have reviewed `r rev_tab["Journal"]` journal articles, `r rev_tab["Conference"]` conference abstracts, and `r rev_tab["Funding body"]` grant applications. 

<details>
  <summary>Click here for a detailed overview of reviewing activities</summary>
```{r results = "asis", echo = FALSE}
rev %>%
  kable("html", escape=F) %>%
    kable_styling(bootstrap_options = c("striped", "hover"))
```
</details><br>


## Teaching

```{r results = "asis", echo = FALSE}
teach <- data.frame(read.csv("teaching_cleaned.csv", stringsAsFactors = FALSE))
super <- data.frame(read.csv("supervision.csv", stringsAsFactors = FALSE))
sum_sup <- tapply(as.numeric(super$Students), factor(super$Level), sum)
```

Since my first teaching appointment in 2006, I have taught continuously, in `r nrow(teach)` courses, from the high-school to post-graduate (e.g., summer schools, pre-conference workshops) level. I have lectured in `r sum(teach$Hoorcolleges)` courses, taught tutorials in `r sum(teach$Werkgroepen)`, coordinated `r sum(teach$Coordinatie)`, and developed the material for `r sum(teach$Ontwikkeling.herziening)` courses.

<details>
  <summary>Click here for a detailed overview of teaching activities</summary>
```{r results = "asis", echo = FALSE}
rownames(teach) <- NULL
names(teach) <- c("Course", "Year", "Meetings", "students", "Lectures", "Tutorials", "Coordination", "Organization", "Syllabus", "Slides", "Digital aids", "Course development", "Details")
teach[sapply(teach, is.logical)] <- lapply(teach[sapply(teach, is.logical)], function(x)ifelse(x, "Yes", ""))
teach %>%
  kable("html", escape=F) %>% 
  add_header_above(c("Course details" = 4, "Responsibilities" = 8, " " =1)) %>%
    kable_styling(bootstrap_options = c("striped", "hover"))
```
</details><br>

I have supervised `r paste0(paste0(sum_sup[1:(length(sum_sup)-1)], " ", names(sum_sup)[1:(length(sum_sup)-1)], collapse = ", "), ", and ", tail(sum_sup, 1), " ", tail(names(sum_sup), 1), collapse = "")` students.

<details>
  <summary>Click here for a detailed overview of supervised students</summary>
```{r results = "asis", echo = FALSE}
rownames(super) <- NULL
super$Level <- ordered(super$Level, levels = c("PhD", "Master", "Bachelor"))
super <- super[order(super$Level), ]
super[, c("Students", "Description", "Details", "Institute", "Level")] %>%
  kable("html", escape=F) %>% 
    kable_styling(bootstrap_options = c("striped", "hover"))
```
</details> 

## Conference attendance

```{r results = "asis", echo = FALSE}
conf <- data.frame(read.csv("conferences.csv", stringsAsFactors = FALSE))
```

I am very active at international conferences, and have contributed to `r nrow(conf)` conferences since my first attendance in 2012.

<details>
  <summary>Click here for a detailed overview of conferences</summary>
```{r results = "asis", echo = FALSE}
conf <- conf[order(conf$Date, decreasing = TRUE), c("Organization", "City", "Country", "Date")]
rownames(conf) <- NULL
conf %>%
  kable("html", escape=F) %>% 
    kable_styling(bootstrap_options = c("striped", "hover"))
```
</details>